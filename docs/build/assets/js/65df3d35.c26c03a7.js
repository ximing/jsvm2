"use strict";(self.webpackChunkjsvm2_docs=self.webpackChunkjsvm2_docs||[]).push([[8559],{715:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>x,frontMatter:()=>i,metadata:()=>d,toc:()=>o});var r=s(6070),l=s(1249);const i={sidebar_position:1},c="API \u6982\u89c8",d={id:"api/overview",title:"API \u6982\u89c8",description:"JSVM2 \u63d0\u4f9b\u4e86\u7b80\u6d01\u800c\u5f3a\u5927\u7684 API\uff0c\u8ba9\u4f60\u80fd\u591f\u8f7b\u677e\u5730\u5728\u6c99\u7bb1\u73af\u5883\u4e2d\u6267\u884c JavaScript \u4ee3\u7801\u3002",source:"@site/docs/api/overview.md",sourceDirName:"api",slug:"/api/overview",permalink:"/jsvm2/docs/api/overview",draft:!1,unlisted:!1,editUrl:"https://github.com/ximing/jsvm2/tree/master/docs/docs/api/overview.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"\u4f7f\u7528\u793a\u4f8b",permalink:"/jsvm2/docs/getting-started/examples"},next:{title:"VM API",permalink:"/jsvm2/docs/api/vm"}},t={},o=[{value:"\u6838\u5fc3 API",id:"\u6838\u5fc3-api",level:2},{value:"\u5feb\u901f\u6267\u884c\u51fd\u6570",id:"\u5feb\u901f\u6267\u884c\u51fd\u6570",level:3},{value:"\u6c99\u7bb1\u6267\u884c\u51fd\u6570",id:"\u6c99\u7bb1\u6267\u884c\u51fd\u6570",level:3},{value:"\u4e0a\u4e0b\u6587\u521b\u5efa\u51fd\u6570",id:"\u4e0a\u4e0b\u6587\u521b\u5efa\u51fd\u6570",level:3},{value:"\u7c7b\u578b\u5b9a\u4e49",id:"\u7c7b\u578b\u5b9a\u4e49",level:2},{value:"ISandBox \u63a5\u53e3",id:"isandbox-\u63a5\u53e3",level:3},{value:"Context \u7c7b",id:"context-\u7c7b",level:3},{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:2},{value:"\u6267\u884c\u8868\u8fbe\u5f0f",id:"\u6267\u884c\u8868\u8fbe\u5f0f",level:3},{value:"\u81ea\u5b9a\u4e49\u6c99\u7bb1\u73af\u5883",id:"\u81ea\u5b9a\u4e49\u6c99\u7bb1\u73af\u5883",level:3},{value:"\u6a21\u5757\u5316\u6267\u884c",id:"\u6a21\u5757\u5316\u6267\u884c",level:3},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:2},{value:"\u5185\u7f6e\u5168\u5c40\u5bf9\u8c61",id:"\u5185\u7f6e\u5168\u5c40\u5bf9\u8c61",level:2},{value:"\u6807\u51c6 ECMAScript \u5bf9\u8c61",id:"\u6807\u51c6-ecmascript-\u5bf9\u8c61",level:3},{value:"Node.js \u73af\u5883\u5bf9\u8c61",id:"nodejs-\u73af\u5883\u5bf9\u8c61",level:3},{value:"\u73b0\u4ee3 JavaScript \u7279\u6027",id:"\u73b0\u4ee3-javascript-\u7279\u6027",level:3},{value:"\u5b89\u5168\u9650\u5236",id:"\u5b89\u5168\u9650\u5236",level:2},{value:"\u9694\u79bb\u4fdd\u62a4",id:"\u9694\u79bb\u4fdd\u62a4",level:3},{value:"\u8d44\u6e90\u63a7\u5236",id:"\u8d44\u6e90\u63a7\u5236",level:3},{value:"\u6027\u80fd\u8003\u8651",id:"\u6027\u80fd\u8003\u8651",level:2},{value:"\u6267\u884c\u6548\u7387",id:"\u6267\u884c\u6548\u7387",level:3},{value:"\u4f18\u5316\u5efa\u8bae",id:"\u4f18\u5316\u5efa\u8bae",level:3},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"api-\u6982\u89c8",children:"API \u6982\u89c8"})}),"\n",(0,r.jsx)(n.p,{children:"JSVM2 \u63d0\u4f9b\u4e86\u7b80\u6d01\u800c\u5f3a\u5927\u7684 API\uff0c\u8ba9\u4f60\u80fd\u591f\u8f7b\u677e\u5730\u5728\u6c99\u7bb1\u73af\u5883\u4e2d\u6267\u884c JavaScript \u4ee3\u7801\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u6838\u5fc3-api",children:"\u6838\u5fc3 API"}),"\n",(0,r.jsx)(n.h3,{id:"\u5feb\u901f\u6267\u884c\u51fd\u6570",children:"\u5feb\u901f\u6267\u884c\u51fd\u6570"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"function run(ast: any, context?: Context): any\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u76f4\u63a5\u6267\u884c AST \u5e76\u8fd4\u56de\u7ed3\u679c\uff0c\u9002\u7528\u4e8e\u7b80\u5355\u7684\u4ee3\u7801\u6267\u884c\u573a\u666f\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u6c99\u7bb1\u6267\u884c\u51fd\u6570",children:"\u6c99\u7bb1\u6267\u884c\u51fd\u6570"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"function runInContext(ast: any, context?: Context): any\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u6307\u5b9a\u7684\u6c99\u7bb1\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c AST\uff0c\u652f\u6301\u6a21\u5757\u5316\u5bfc\u51fa\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u4e0a\u4e0b\u6587\u521b\u5efa\u51fd\u6570",children:"\u4e0a\u4e0b\u6587\u521b\u5efa\u51fd\u6570"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"function createContext(sandbox?: ISandBox): Context\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6267\u884c\u4e0a\u4e0b\u6587\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6c99\u7bb1\u73af\u5883\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u7c7b\u578b\u5b9a\u4e49",children:"\u7c7b\u578b\u5b9a\u4e49"}),"\n",(0,r.jsx)(n.h3,{id:"isandbox-\u63a5\u53e3",children:"ISandBox \u63a5\u53e3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface ISandBox {\n  [key: string]: any;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6c99\u7bb1\u73af\u5883\u5bf9\u8c61\uff0c\u5b9a\u4e49\u4e86\u4ee3\u7801\u6267\u884c\u65f6\u53ef\u8bbf\u95ee\u7684\u5168\u5c40\u53d8\u91cf\u548c\u51fd\u6570\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"context-\u7c7b",children:"Context \u7c7b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"class Context {\n  constructor(externalContext: ISandBox = {})\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6267\u884c\u4e0a\u4e0b\u6587\u7c7b\uff0c\u5305\u542b\u4e86\u4ee3\u7801\u6267\u884c\u6240\u9700\u7684\u5168\u5c40\u73af\u5883\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u57fa\u672c\u7528\u6cd5",children:"\u57fa\u672c\u7528\u6cd5"}),"\n",(0,r.jsx)(n.h3,{id:"\u6267\u884c\u8868\u8fbe\u5f0f",children:"\u6267\u884c\u8868\u8fbe\u5f0f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import { run } from 'jsvm2';\nimport { parse } from '@babel/parser';\n\n// \u89e3\u6790\u4ee3\u7801\u4e3a AST\nconst ast = parse('1 + 2 * 3');\n\n// \u6267\u884c\u5e76\u83b7\u53d6\u7ed3\u679c\nconst result = run(ast);\nconsole.log(result); // 7\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49\u6c99\u7bb1\u73af\u5883",children:"\u81ea\u5b9a\u4e49\u6c99\u7bb1\u73af\u5883"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import { createContext, runInContext } from 'jsvm2';\nimport { parse } from '@babel/parser';\n\n// \u521b\u5efa\u81ea\u5b9a\u4e49\u6c99\u7bb1\nconst sandbox = createContext({\n  x: 10,\n  y: 20,\n  multiply: (a, b) => a * b\n});\n\n// \u6267\u884c\u4ee3\u7801\nconst ast = parse('multiply(x, y)');\nconst result = runInContext(ast, sandbox);\nconsole.log(result); // 200\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u6a21\u5757\u5316\u6267\u884c",children:"\u6a21\u5757\u5316\u6267\u884c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import { createContext, runInContext } from 'jsvm2';\nimport { parse } from '@babel/parser';\n\nconst code = `\n  function add(a, b) {\n    return a + b;\n  }\n\n  module.exports = { add };\n`;\n\nconst ast = parse(code, { sourceType: 'module' });\nconst context = createContext();\nconst moduleExports = runInContext(ast, context);\n\nconsole.log(moduleExports.add(2, 3)); // 5\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709 API \u90fd\u4f1a\u629b\u51fa\u6807\u51c6\u7684 JavaScript \u9519\u8bef\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import { run } from 'jsvm2';\nimport { parse } from '@babel/parser';\n\ntry {\n  const ast = parse('undefinedVariable');\n  run(ast);\n} catch (error) {\n  console.log(error instanceof ReferenceError); // true\n  console.log(error.message); // \"undefinedVariable is not defined\"\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5185\u7f6e\u5168\u5c40\u5bf9\u8c61",children:"\u5185\u7f6e\u5168\u5c40\u5bf9\u8c61"}),"\n",(0,r.jsx)(n.h3,{id:"\u6807\u51c6-ecmascript-\u5bf9\u8c61",children:"\u6807\u51c6 ECMAScript \u5bf9\u8c61"}),"\n",(0,r.jsx)(n.p,{children:"Context \u9ed8\u8ba4\u5305\u542b\u4ee5\u4e0b\u6807\u51c6\u5bf9\u8c61\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u57fa\u672c\u503c"}),": ",(0,r.jsx)(n.code,{children:"Infinity"}),", ",(0,r.jsx)(n.code,{children:"NaN"}),", ",(0,r.jsx)(n.code,{children:"undefined"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5168\u5c40\u51fd\u6570"}),": ",(0,r.jsx)(n.code,{children:"isFinite"}),", ",(0,r.jsx)(n.code,{children:"isNaN"}),", ",(0,r.jsx)(n.code,{children:"parseFloat"}),", ",(0,r.jsx)(n.code,{children:"parseInt"}),", ",(0,r.jsx)(n.code,{children:"decodeURI"}),", \u7b49"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6784\u9020\u51fd\u6570"}),": ",(0,r.jsx)(n.code,{children:"Object"}),", ",(0,r.jsx)(n.code,{children:"Function"}),", ",(0,r.jsx)(n.code,{children:"Boolean"}),", ",(0,r.jsx)(n.code,{children:"Number"}),", ",(0,r.jsx)(n.code,{children:"String"}),", ",(0,r.jsx)(n.code,{children:"Array"}),", \u7b49"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9519\u8bef\u5bf9\u8c61"}),": ",(0,r.jsx)(n.code,{children:"Error"}),", ",(0,r.jsx)(n.code,{children:"TypeError"}),", ",(0,r.jsx)(n.code,{children:"ReferenceError"}),", \u7b49"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5b9e\u7528\u5bf9\u8c61"}),": ",(0,r.jsx)(n.code,{children:"Math"}),", ",(0,r.jsx)(n.code,{children:"Date"}),", ",(0,r.jsx)(n.code,{children:"RegExp"}),", ",(0,r.jsx)(n.code,{children:"JSON"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"nodejs-\u73af\u5883\u5bf9\u8c61",children:"Node.js \u73af\u5883\u5bf9\u8c61"}),"\n",(0,r.jsx)(n.p,{children:"\u5728 Node.js \u73af\u5883\u4e2d\uff0c\u8fd8\u5305\u542b\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"console"})," - \u63a7\u5236\u53f0\u8f93\u51fa"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"setTimeout"})," / ",(0,r.jsx)(n.code,{children:"clearTimeout"})," - \u5b9a\u65f6\u5668"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"setInterval"})," / ",(0,r.jsx)(n.code,{children:"clearInterval"})," - \u95f4\u9694\u5b9a\u65f6\u5668"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u73b0\u4ee3-javascript-\u7279\u6027",children:"\u73b0\u4ee3 JavaScript \u7279\u6027"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u5bbf\u4e3b\u73af\u5883\u652f\u6301\uff0c\u8fd8\u4f1a\u5305\u542b\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Symbol"})," - \u7b26\u53f7\u7c7b\u578b"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Promise"})," - \u5f02\u6b65\u5904\u7406"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Map"})," / ",(0,r.jsx)(n.code,{children:"Set"})," - \u96c6\u5408\u7c7b\u578b"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Proxy"})," / ",(0,r.jsx)(n.code,{children:"Reflect"})," - \u5143\u7f16\u7a0b"]}),"\n",(0,r.jsx)(n.li,{children:"\u5404\u79cd TypedArray \u7c7b\u578b"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5b89\u5168\u9650\u5236",children:"\u5b89\u5168\u9650\u5236"}),"\n",(0,r.jsx)(n.h3,{id:"\u9694\u79bb\u4fdd\u62a4",children:"\u9694\u79bb\u4fdd\u62a4"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6c99\u7bb1\u4ee3\u7801\u65e0\u6cd5\u8bbf\u95ee\u5bbf\u4e3b\u73af\u5883\u7684\u5168\u5c40\u53d8\u91cf"}),"\n",(0,r.jsx)(n.li,{children:"\u65e0\u6cd5\u4fee\u6539\u539f\u751f\u5bf9\u8c61\u7684\u539f\u578b\u94fe"}),"\n",(0,r.jsx)(n.li,{children:"\u65e0\u6cd5\u8bbf\u95ee Node.js \u7684\u6a21\u5757\u7cfb\u7edf\uff08\u9664\u975e\u663e\u5f0f\u63d0\u4f9b\uff09"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u8d44\u6e90\u63a7\u5236",children:"\u8d44\u6e90\u63a7\u5236"}),"\n",(0,r.jsx)(n.p,{children:"\u867d\u7136 JSVM2 \u63d0\u4f9b\u4e86\u6267\u884c\u9694\u79bb\uff0c\u4f46\u4e0d\u5305\u542b\u4ee5\u4e0b\u9650\u5236\uff08\u9700\u8981\u5728\u5e94\u7528\u5c42\u5b9e\u73b0\uff09\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6267\u884c\u65f6\u95f4\u9650\u5236"}),"\n",(0,r.jsx)(n.li,{children:"\u5185\u5b58\u4f7f\u7528\u9650\u5236"}),"\n",(0,r.jsx)(n.li,{children:"\u65e0\u9650\u5faa\u73af\u68c0\u6d4b"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u6027\u80fd\u8003\u8651",children:"\u6027\u80fd\u8003\u8651"}),"\n",(0,r.jsx)(n.h3,{id:"\u6267\u884c\u6548\u7387",children:"\u6267\u884c\u6548\u7387"}),"\n",(0,r.jsx)(n.p,{children:"JSVM2 \u7684\u6267\u884c\u901f\u5ea6\u6bd4\u539f\u751f JavaScript \u6162\uff0c\u4e3b\u8981\u539f\u56e0\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"AST \u89e3\u91ca\u6267\u884c\u800c\u975e\u7f16\u8bd1"}),"\n",(0,r.jsx)(n.li,{children:"\u989d\u5916\u7684\u5b89\u5168\u68c0\u67e5\u548c\u4f5c\u7528\u57df\u7ba1\u7406"}),"\n",(0,r.jsx)(n.li,{children:"\u8bbf\u95ee\u5668\u6a21\u5f0f\u7684\u5f00\u9500"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u4f18\u5316\u5efa\u8bae",children:"\u4f18\u5316\u5efa\u8bae"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u590d\u7528 Context"}),": \u907f\u514d\u9891\u7e41\u521b\u5efa\u65b0\u7684\u4e0a\u4e0b\u6587"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9884\u7f16\u8bd1 AST"}),": \u7f13\u5b58\u89e3\u6790\u540e\u7684 AST \u5bf9\u8c61"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6700\u5c0f\u5316\u6c99\u7bb1"}),": \u53ea\u5305\u542b\u5fc5\u8981\u7684\u5168\u5c40\u5bf9\u8c61"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6279\u91cf\u6267\u884c"}),": \u5c06\u591a\u4e2a\u64cd\u4f5c\u5408\u5e76\u5230\u4e00\u6b21\u6267\u884c\u4e2d"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// \u597d\u7684\u505a\u6cd5\nconst context = createContext(/* ... */);\nconst asts = codes.map(code => parse(code));\n\nconst results = asts.map(ast => runInContext(ast, context));\n\n// \u907f\u514d\u7684\u505a\u6cd5\nconst results = codes.map(code => {\n  const context = createContext(/* ... */); // \u6bcf\u6b21\u90fd\u521b\u5efa\u65b0\u4e0a\u4e0b\u6587\n  const ast = parse(code); // \u6bcf\u6b21\u90fd\u89e3\u6790\n  return runInContext(ast, context);\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./vm",children:"VM API"})," - \u8be6\u7ec6\u4e86\u89e3\u865a\u62df\u673a API"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./context",children:"Context API"})," - \u6df1\u5165\u5b66\u4e60\u4e0a\u4e0b\u6587\u7ba1\u7406"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./scope",children:"Scope API"})," - \u4e86\u89e3\u4f5c\u7528\u57df\u7cfb\u7edf"]}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);