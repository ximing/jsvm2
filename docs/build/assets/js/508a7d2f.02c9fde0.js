"use strict";(self.webpackChunkjsvm2_docs=self.webpackChunkjsvm2_docs||[]).push([[1376],{35:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>i});var s=t(6070),r=t(1249);const a={sidebar_position:3},o="\u4f7f\u7528\u793a\u4f8b",l={id:"getting-started/examples",title:"\u4f7f\u7528\u793a\u4f8b",description:"\u672c\u8282\u63d0\u4f9b\u4e86 JSVM2 \u5728\u5404\u79cd\u5b9e\u9645\u573a\u666f\u4e2d\u7684\u4f7f\u7528\u793a\u4f8b\u3002",source:"@site/docs/getting-started/examples.md",sourceDirName:"getting-started",slug:"/getting-started/examples",permalink:"/jsvm2/docs/getting-started/examples",draft:!1,unlisted:!1,editUrl:"https://github.com/ximing/jsvm2/tree/master/docs/docs/getting-started/examples.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"\u57fa\u7840\u7528\u6cd5",permalink:"/jsvm2/docs/getting-started/basic-usage"},next:{title:"API \u6982\u89c8",permalink:"/jsvm2/docs/api/overview"}},c={},i=[{value:"\u5728\u7ebf\u4ee3\u7801\u6267\u884c\u5668",id:"\u5728\u7ebf\u4ee3\u7801\u6267\u884c\u5668",level:2},{value:"\u914d\u7f6e\u5f15\u64ce",id:"\u914d\u7f6e\u5f15\u64ce",level:2},{value:"\u63d2\u4ef6\u7cfb\u7edf",id:"\u63d2\u4ef6\u7cfb\u7edf",level:2},{value:"\u8868\u8fbe\u5f0f\u8ba1\u7b97\u5668",id:"\u8868\u8fbe\u5f0f\u8ba1\u7b97\u5668",level:2},{value:"\u6a21\u677f\u5f15\u64ce",id:"\u6a21\u677f\u5f15\u64ce",level:2},{value:"\u5355\u5143\u6d4b\u8bd5\u8f85\u52a9",id:"\u5355\u5143\u6d4b\u8bd5\u8f85\u52a9",level:2}];function u(n){const e={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"\u4f7f\u7528\u793a\u4f8b",children:"\u4f7f\u7528\u793a\u4f8b"})}),"\n",(0,s.jsx)(e.p,{children:"\u672c\u8282\u63d0\u4f9b\u4e86 JSVM2 \u5728\u5404\u79cd\u5b9e\u9645\u573a\u666f\u4e2d\u7684\u4f7f\u7528\u793a\u4f8b\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"\u5728\u7ebf\u4ee3\u7801\u6267\u884c\u5668",children:"\u5728\u7ebf\u4ee3\u7801\u6267\u884c\u5668"}),"\n",(0,s.jsx)(e.p,{children:"\u521b\u5efa\u4e00\u4e2a\u5b89\u5168\u7684\u5728\u7ebf\u4ee3\u7801\u6267\u884c\u73af\u5883\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"import { createContext, runInContext } from 'jsvm2';\n\nclass CodeExecutor {\n  constructor() {\n    // \u521b\u5efa\u53d7\u9650\u7684\u6c99\u7bb1\u73af\u5883\n    this.sandbox = createContext({\n      // \u63d0\u4f9b\u57fa\u672c\u7684\u5168\u5c40\u5bf9\u8c61\n      console: {\n        log: (...args) => this.output.push(['log', ...args]),\n        error: (...args) => this.output.push(['error', ...args]),\n        warn: (...args) => this.output.push(['warn', ...args])\n      },\n      // \u63d0\u4f9b\u90e8\u5206 Math \u5bf9\u8c61\n      Math: Math,\n      // \u63d0\u4f9b\u90e8\u5206 Array \u548c Object \u65b9\u6cd5\n      Array: Array,\n      Object: Object\n    });\n    this.output = [];\n  }\n\n  execute(code) {\n    this.output = [];\n    try {\n      const result = runInContext(code, this.sandbox);\n      return {\n        success: true,\n        result,\n        output: this.output\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error.message,\n        output: this.output\n      };\n    }\n  }\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nconst executor = new CodeExecutor();\n\nconst result1 = executor.execute(`\n  console.log('Hello, World!');\n  const numbers = [1, 2, 3, 4, 5];\n  numbers.filter(n => n % 2 === 0).map(n => n * 2);\n`);\n\nconsole.log(result1);\n// {\n//   success: true,\n//   result: [4, 8],\n//   output: [['log', 'Hello, World!']]\n// }\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u914d\u7f6e\u5f15\u64ce",children:"\u914d\u7f6e\u5f15\u64ce"}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528 JSVM2 \u6267\u884c\u52a8\u6001\u914d\u7f6e\u811a\u672c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"import { createContext, runInContext } from 'jsvm2';\n\nclass ConfigEngine {\n  constructor(baseConfig = {}) {\n    this.baseConfig = baseConfig;\n    this.sandbox = createContext({\n      // \u63d0\u4f9b\u914d\u7f6e\u8f85\u52a9\u51fd\u6570\n      env: (key, defaultValue) => process.env[key] || defaultValue,\n      merge: (obj1, obj2) => ({ ...obj1, ...obj2 }),\n      // \u63d0\u4f9b\u57fa\u7840\u6570\u636e\n      ...baseConfig\n    });\n  }\n\n  evaluateConfig(configScript) {\n    return runInContext(configScript, this.sandbox);\n  }\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nconst engine = new ConfigEngine({\n  appName: 'MyApp',\n  version: '1.0.0'\n});\n\nconst config = engine.evaluateConfig(`\n  const isDev = env('NODE_ENV', 'development') === 'development';\n\n  merge({\n    name: appName,\n    version: version,\n    debug: isDev,\n    port: isDev ? 3000 : 8080,\n    database: {\n      host: env('DB_HOST', 'localhost'),\n      port: parseInt(env('DB_PORT', '5432')),\n      name: env('DB_NAME', appName.toLowerCase())\n    }\n  }, {\n    features: {\n      logging: true,\n      monitoring: !isDev\n    }\n  });\n`);\n\nconsole.log(config);\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u63d2\u4ef6\u7cfb\u7edf",children:"\u63d2\u4ef6\u7cfb\u7edf"}),"\n",(0,s.jsx)(e.p,{children:"\u521b\u5efa\u4e00\u4e2a\u5b89\u5168\u7684\u63d2\u4ef6\u6267\u884c\u73af\u5883\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"import { createContext, runInContext } from 'jsvm2';\n\nclass PluginManager {\n  constructor() {\n    this.plugins = new Map();\n    this.hooks = new Map();\n  }\n\n  // \u6ce8\u518c\u63d2\u4ef6\n  registerPlugin(name, pluginCode) {\n    const sandbox = createContext({\n      // \u63d2\u4ef6 API\n      registerHook: (hookName, callback) => {\n        if (!this.hooks.has(hookName)) {\n          this.hooks.set(hookName, []);\n        }\n        this.hooks.get(hookName).push(callback);\n      },\n\n      // \u5de5\u5177\u51fd\u6570\n      utils: {\n        format: (template, ...args) => {\n          return template.replace(/{(\\d+)}/g, (match, number) => {\n            return typeof args[number] !== 'undefined' ? args[number] : match;\n          });\n        },\n\n        debounce: (func, wait) => {\n          let timeout;\n          return function executedFunction(...args) {\n            const later = () => {\n              clearTimeout(timeout);\n              func(...args);\n            };\n            clearTimeout(timeout);\n            timeout = setTimeout(later, wait);\n          };\n        }\n      }\n    });\n\n    try {\n      const plugin = runInContext(pluginCode, sandbox);\n      this.plugins.set(name, plugin);\n      console.log(`\u63d2\u4ef6 ${name} \u6ce8\u518c\u6210\u529f`);\n    } catch (error) {\n      console.error(`\u63d2\u4ef6 ${name} \u6ce8\u518c\u5931\u8d25:`, error.message);\n    }\n  }\n\n  // \u6267\u884c\u94a9\u5b50\n  async executeHook(hookName, ...args) {\n    const hooks = this.hooks.get(hookName) || [];\n    const results = [];\n\n    for (const hook of hooks) {\n      try {\n        const result = await hook(...args);\n        results.push(result);\n      } catch (error) {\n        console.error(`\u94a9\u5b50 ${hookName} \u6267\u884c\u5931\u8d25:`, error.message);\n      }\n    }\n\n    return results;\n  }\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nconst pluginManager = new PluginManager();\n\n// \u6ce8\u518c\u4e00\u4e2a\u65e5\u5fd7\u63d2\u4ef6\npluginManager.registerPlugin('logger', `\n  registerHook('beforeSave', (data) => {\n    console.log('\u51c6\u5907\u4fdd\u5b58\u6570\u636e:', data);\n    return { timestamp: Date.now(), ...data };\n  });\n\n  registerHook('afterSave', (result) => {\n    console.log('\u6570\u636e\u4fdd\u5b58\u5b8c\u6210:', result);\n  });\n\n  // \u5bfc\u51fa\u63d2\u4ef6\u4fe1\u606f\n  ({\n    name: 'Logger Plugin',\n    version: '1.0.0',\n    description: '\u63d0\u4f9b\u65e5\u5fd7\u8bb0\u5f55\u529f\u80fd'\n  });\n`);\n\n// \u6267\u884c\u94a9\u5b50\nasync function saveData(data) {\n  const processedData = await pluginManager.executeHook('beforeSave', data);\n  const result = { id: Math.random(), ...processedData[0] };\n  await pluginManager.executeHook('afterSave', result);\n  return result;\n}\n\nsaveData({ name: 'test', value: 42 });\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u8868\u8fbe\u5f0f\u8ba1\u7b97\u5668",children:"\u8868\u8fbe\u5f0f\u8ba1\u7b97\u5668"}),"\n",(0,s.jsx)(e.p,{children:"\u521b\u5efa\u4e00\u4e2a\u5b89\u5168\u7684\u6570\u5b66\u8868\u8fbe\u5f0f\u8ba1\u7b97\u5668\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"import { createContext, runInContext } from 'jsvm2';\n\nclass ExpressionCalculator {\n  constructor() {\n    this.sandbox = createContext({\n      // \u6570\u5b66\u51fd\u6570\n      Math: Math,\n\n      // \u81ea\u5b9a\u4e49\u51fd\u6570\n      sum: (...args) => args.reduce((a, b) => a + b, 0),\n      avg: (...args) => args.reduce((a, b) => a + b, 0) / args.length,\n\n      // \u5e38\u91cf\n      PI: Math.PI,\n      E: Math.E\n    });\n  }\n\n  calculate(expression) {\n    try {\n      // \u9a8c\u8bc1\u8868\u8fbe\u5f0f\u5b89\u5168\u6027\uff08\u7b80\u5355\u68c0\u67e5\uff09\n      if (this.containsUnsafeOperations(expression)) {\n        throw new Error('\u8868\u8fbe\u5f0f\u5305\u542b\u4e0d\u5b89\u5168\u7684\u64cd\u4f5c');\n      }\n\n      const result = runInContext(expression, this.sandbox);\n\n      if (typeof result !== 'number' || !isFinite(result)) {\n        throw new Error('\u8868\u8fbe\u5f0f\u7ed3\u679c\u5fc5\u987b\u662f\u6709\u6548\u6570\u5b57');\n      }\n\n      return result;\n    } catch (error) {\n      throw new Error(`\u8ba1\u7b97\u9519\u8bef: ${error.message}`);\n    }\n  }\n\n  containsUnsafeOperations(expression) {\n    const unsafePatterns = [\n      /function\\s*\\(/,\n      /=>/,\n      /eval\\s*\\(/,\n      /constructor/,\n      /prototype/,\n      /__proto__/\n    ];\n\n    return unsafePatterns.some(pattern => pattern.test(expression));\n  }\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nconst calculator = new ExpressionCalculator();\n\nconsole.log(calculator.calculate('2 + 3 * 4')); // 14\nconsole.log(calculator.calculate('Math.sqrt(16) + Math.pow(2, 3)')); // 12\nconsole.log(calculator.calculate('sum(1, 2, 3, 4, 5)')); // 15\nconsole.log(calculator.calculate('avg(10, 20, 30) * 2')); // 40\n\ntry {\n  calculator.calculate('function() { return 42; }()');\n} catch (error) {\n  console.log(error.message); // \"\u8868\u8fbe\u5f0f\u5305\u542b\u4e0d\u5b89\u5168\u7684\u64cd\u4f5c\"\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6a21\u677f\u5f15\u64ce",children:"\u6a21\u677f\u5f15\u64ce"}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528 JSVM2 \u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u6a21\u677f\u5f15\u64ce\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"import { createContext, runInContext } from 'jsvm2';\n\nclass TemplateEngine {\n  constructor() {\n    this.sandbox = createContext({\n      // \u6a21\u677f\u8f85\u52a9\u51fd\u6570\n      formatDate: (date) => new Date(date).toLocaleDateString('zh-CN'),\n      formatNumber: (num) => num.toLocaleString('zh-CN'),\n      escapeHtml: (str) => str\n        .replace(/&/g, '&aemp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#39;'),\n\n      // \u6761\u4ef6\u6e32\u67d3\n      if: (condition, trueValue, falseValue) => condition ? trueValue : falseValue\n    });\n  }\n\n  render(template, data) {\n    // \u521b\u5efa\u5e26\u6570\u636e\u7684\u6c99\u7bb1\n    const templateSandbox = createContext({\n      ...this.sandbox,\n      ...data\n    });\n\n    try {\n      // \u5c06\u6a21\u677f\u8f6c\u6362\u4e3a\u53ef\u6267\u884c\u4ee3\u7801\n      const code = this.compileTemplate(template);\n      return runInContext(code, templateSandbox);\n    } catch (error) {\n      throw new Error(`\u6a21\u677f\u6e32\u67d3\u9519\u8bef: ${error.message}`);\n    }\n  }\n\n  compileTemplate(template) {\n    // \u7b80\u5355\u7684\u6a21\u677f\u7f16\u8bd1\uff08\u5b9e\u9645\u9879\u76ee\u4e2d\u5e94\u8be5\u66f4\u590d\u6742\uff09\n    return `\n      const parts = [];\n      ${template.replace(/\\{\\{(.+?)\\}\\}/g, (match, expression) => {\n        return `parts.push(${expression.trim()});`;\n      })}\n      parts.join('');\n    `;\n  }\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nconst templateEngine = new TemplateEngine();\n\nconst template = `\n{{name}} \u7684\u4e2a\u4eba\u4fe1\u606f\uff1a\n- \u5e74\u9f84\uff1a{{age}} \u5c81\n- \u4f59\u989d\uff1a\xa5{{formatNumber(balance)}}\n- \u6ce8\u518c\u65f6\u95f4\uff1a{{formatDate(registerDate)}}\n- \u72b6\u6001\uff1a{{if(isVip, 'VIP\u4f1a\u5458', '\u666e\u901a\u7528\u6237')}}\n`;\n\nconst data = {\n  name: '\u5f20\u4e09',\n  age: 25,\n  balance: 12345.67,\n  registerDate: '2023-01-15',\n  isVip: true\n};\n\nconst result = templateEngine.render(template, data);\nconsole.log(result);\n// \u5f20\u4e09 \u7684\u4e2a\u4eba\u4fe1\u606f\uff1a\n// - \u5e74\u9f84\uff1a25 \u5c81\n// - \u4f59\u989d\uff1a\xa512,345.67\n// - \u6ce8\u518c\u65f6\u95f4\uff1a2023/1/15\n// - \u72b6\u6001\uff1aVIP\u4f1a\u5458\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5355\u5143\u6d4b\u8bd5\u8f85\u52a9",children:"\u5355\u5143\u6d4b\u8bd5\u8f85\u52a9"}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528 JSVM2 \u521b\u5efa\u9694\u79bb\u7684\u6d4b\u8bd5\u73af\u5883\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"import { createContext, runInContext } from 'jsvm2';\n\nclass TestRunner {\n  constructor() {\n    this.tests = [];\n    this.results = [];\n  }\n\n  createTestSandbox() {\n    return createContext({\n      // \u65ad\u8a00\u51fd\u6570\n      assert: {\n        equal: (actual, expected, message) => {\n          if (actual !== expected) {\n            throw new Error(message || `Expected ${expected}, got ${actual}`);\n          }\n        },\n\n        deepEqual: (actual, expected, message) => {\n          if (JSON.stringify(actual) !== JSON.stringify(expected)) {\n            throw new Error(message || `Deep equality failed`);\n          }\n        },\n\n        throws: (fn, message) => {\n          try {\n            fn();\n            throw new Error(message || 'Expected function to throw');\n          } catch (error) {\n            // \u9884\u671f\u7684\u9519\u8bef\n          }\n        }\n      },\n\n      // \u6d4b\u8bd5\u5de5\u5177\n      spy: (fn) => {\n        const calls = [];\n        const spy = function(...args) {\n          calls.push(args);\n          return fn ? fn.apply(this, args) : undefined;\n        };\n        spy.calls = calls;\n        spy.callCount = () => calls.length;\n        return spy;\n      }\n    });\n  }\n\n  test(name, testFn) {\n    this.tests.push({ name, testFn });\n  }\n\n  async run() {\n    this.results = [];\n\n    for (const test of this.tests) {\n      const sandbox = this.createTestSandbox();\n      const startTime = Date.now();\n\n      try {\n        await runInContext(test.testFn.toString() + '()', sandbox);\n        this.results.push({\n          name: test.name,\n          status: 'passed',\n          duration: Date.now() - startTime\n        });\n      } catch (error) {\n        this.results.push({\n          name: test.name,\n          status: 'failed',\n          error: error.message,\n          duration: Date.now() - startTime\n        });\n      }\n    }\n\n    return this.results;\n  }\n\n  report() {\n    const passed = this.results.filter(r => r.status === 'passed').length;\n    const failed = this.results.filter(r => r.status === 'failed').length;\n\n    console.log(`\\n\u6d4b\u8bd5\u62a5\u544a:`);\n    console.log(`\u901a\u8fc7: ${passed}, \u5931\u8d25: ${failed}, \u603b\u8ba1: ${this.results.length}`);\n\n    this.results.forEach(result => {\n      const status = result.status === 'passed' ? '\u2705' : '\u274c';\n      console.log(`${status} ${result.name} (${result.duration}ms)`);\n      if (result.error) {\n        console.log(`   \u9519\u8bef: ${result.error}`);\n      }\n    });\n  }\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nconst runner = new TestRunner();\n\nrunner.test('\u57fa\u672c\u6570\u5b66\u8fd0\u7b97', function() {\n  assert.equal(2 + 2, 4, '2 + 2 \u5e94\u8be5\u7b49\u4e8e 4');\n  assert.equal(3 * 4, 12, '3 * 4 \u5e94\u8be5\u7b49\u4e8e 12');\n});\n\nrunner.test('\u6570\u7ec4\u64cd\u4f5c', function() {\n  const arr = [1, 2, 3];\n  const doubled = arr.map(x => x * 2);\n  assert.deepEqual(doubled, [2, 4, 6], '\u6570\u7ec4\u5143\u7d20\u5e94\u8be5\u90fd\u4e58\u4ee52');\n});\n\nrunner.test('\u95f4\u8c0d\u51fd\u6570', function() {\n  const mockFn = spy();\n  mockFn('hello', 'world');\n  mockFn('foo');\n\n  assert.equal(mockFn.callCount(), 2, '\u51fd\u6570\u5e94\u8be5\u88ab\u8c03\u75282\u6b21');\n  assert.deepEqual(mockFn.calls[0], ['hello', 'world'], '\u7b2c\u4e00\u6b21\u8c03\u7528\u53c2\u6570\u6b63\u786e');\n});\n\n// \u8fd0\u884c\u6d4b\u8bd5\nrunner.run().then(() => {\n  runner.report();\n});\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u4e9b\u793a\u4f8b\u5c55\u793a\u4e86 JSVM2 \u5728\u4e0d\u540c\u573a\u666f\u4e0b\u7684\u5e94\u7528\u65b9\u5f0f\uff0c\u4ece\u7b80\u5355\u7684\u4ee3\u7801\u6267\u884c\u5230\u590d\u6742\u7684\u7cfb\u7edf\u96c6\u6210\uff0c\u90fd\u80fd\u63d0\u4f9b\u5b89\u5168\u53ef\u9760\u7684\u6c99\u7bb1\u73af\u5883\u3002"})]})}function p(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(u,{...n})}):u(n)}}}]);